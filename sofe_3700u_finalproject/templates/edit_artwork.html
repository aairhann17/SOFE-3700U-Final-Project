<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Edit Artwork</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">Museum</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="/view_records.html">Browse</a></li>
        <li class="nav-item"><a class="nav-link" href="/search.html">Search</a></li>
        <li class="nav-item"><a class="nav-link" href="/stats.html">Stats</a></li>
        {% if user and user.role == 1 %}<li class="nav-item"><a class="nav-link" href="/add_record.html">Add Artwork</a></li>{% endif %}
        {% if user and user.role == 1 %}<li class="nav-item"><a class="nav-link" href="/import_artworks.html">Import</a></li>{% endif %}
        {% if user %}<li class="nav-item"><a class="nav-link" href="/logout">Logout</a></li>{% endif %}
      </ul>
    </div>
  </div>
</nav>
<div class="container">
  <h1 class="mb-4">Edit Artwork #{{ object_id }}</h1>
  <form id="editForm" class="card p-4 shadow-sm bg-white">
    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label">Title</label>
        <input class="form-control" name="Title" required />
      </div>
      <div class="col-md-6">
        <label class="form-label">Object Type</label>
        <input class="form-control" name="ObjectType" />
      </div>
      <div class="col-md-6">
        <label class="form-label">Medium</label>
        <input class="form-control" name="Medium" />
      </div>
      <div class="col-md-6">
        <label class="form-label">Year Created</label>
        <input class="form-control" name="YearCreated" />
      </div>
      <div class="col-md-6">
        <label class="form-label">OriginID</label>
        <input class="form-control" name="OriginID" />
      </div>
      <div class="col-md-6">
        <label class="form-label">GalleryID</label>
        <input class="form-control" name="GalleryID" />
      </div>
    </div>
    <div class="mt-4 d-flex gap-2">
      <button type="submit" class="btn btn-primary">Save Changes</button>
      <button type="button" id="deleteBtn" class="btn btn-danger">Delete</button>
    </div>
    <div id="msg" class="mt-3"></div>
  </form>
</div>
<script>
const id = {{ object_id }};
async function load(){
  const r = await fetch(`/api/artworks/${id}`);
  if(!r.ok){document.getElementById('msg').textContent='Failed to load.';return;}
  const data = await r.json();
  const form = document.getElementById('editForm');
  for(const f of form.elements){if(data[f.name]!==undefined) f.value = data[f.name];}
}
load();

document.getElementById('editForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const form = e.target;
  const payload = {};
  for(const el of form.elements){if(el.name) payload[el.name]=el.value;}
  const res = await fetch(`/api/artworks/${id}`,{method:'PUT', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)});
  const data = await res.json();
  document.getElementById('msg').innerHTML = `<div class="alert ${res.ok?'alert-success':'alert-danger'}">${data.message||data.error}</div>`;
});

document.getElementById('deleteBtn').addEventListener('click', async ()=>{
  if(!confirm('Delete this artwork?')) return;
  const res = await fetch(`/api/artworks/${id}`,{method:'DELETE'});
  const data = await res.json();
  document.getElementById('msg').innerHTML = `<div class="alert ${res.ok?'alert-warning':'alert-danger'}">${data.message||data.error}</div>`;
  if(res.ok) setTimeout(()=> window.location='/view_records.html', 1200);
});
</script>
</body>
</html>
