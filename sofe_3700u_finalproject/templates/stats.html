<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Statistics</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">Museum</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="/view_records.html">Browse</a></li>
        <li class="nav-item"><a class="nav-link" href="/search.html">Search</a></li>
        <li class="nav-item"><a class="nav-link" href="/views.html">SQL Views</a></li>
        {% if user and user.role == 1 %}<li class="nav-item"><a class="nav-link" href="/add_record.html">Add Artwork</a></li>{% endif %}
        {% if user and user.role == 1 %}<li class="nav-item"><a class="nav-link" href="/import_artworks.html">Import</a></li>{% endif %}
        <li class="nav-item"><a class="nav-link active" href="/stats.html">Stats</a></li>
        {% if user %}
          <li class="nav-item"><a class="nav-link" href="/logout">Logout</a></li>
        {% else %}
          <li class="nav-item"><a class="nav-link" href="/login">Login</a></li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>
<div class="container">
  <h1 class="mb-4">Collection Statistics</h1>
  <div class="row">
    <div class="col-md-4">
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">Totals</h5>
          <p class="mb-1" id="artworksTotal">Artworks: ...</p>
          <p class="mb-0" id="artistsTotal">Artists: ...</p>
        </div>
      </div>
    </div>
    <div class="col-md-8">
      <canvas id="countriesChart" height="140"></canvas>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <canvas id="artistsChart" height="120"></canvas>
    </div>
  </div>
</div>
<script>
async function loadStats(){
  const res = await fetch('/api/stats');
  const data = await res.json();
  document.getElementById('artworksTotal').textContent = 'Artworks: ' + data.artworks;
  document.getElementById('artistsTotal').textContent = 'Artists: ' + data.artists;
  const countryLabels = data.topCountries.map(c=> c.Country || 'Unknown');
  const countryCounts = data.topCountries.map(c=> c.count);
  new Chart(document.getElementById('countriesChart'), {
    type: 'bar',
    data: {labels: countryLabels, datasets:[{label:'Artworks by Country', data: countryCounts, backgroundColor:'#0d6efd'}]}
  });
  const artistLabels = data.topArtists.map(a=> a.ArtistName);
  const artistCounts = data.topArtists.map(a=> a.count);
  new Chart(document.getElementById('artistsChart'), {
    type: 'bar',
    data: {labels: artistLabels, datasets:[{label:'Top Artists (Artworks)', data: artistCounts, backgroundColor:'#6610f2'}]},
    options:{indexAxis:'y'}
  });
}
loadStats();
</script>
</body>
</html>
